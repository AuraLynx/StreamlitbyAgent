# Repository Guidelines

このリポジトリで作業する際の最小限の約束事と手順をまとめています。Streamlit ベースの小規模構成を保ちつつ、共通の進め方で変更を積み上げてください。UI とロジックの分離、設定管理の一貫性を守ることが安定性につながります。

## プロジェクト構成
- `app.py`: Streamlit のエントリーポイント。共通ヘルパーを呼びつつランディングを描画。
- `pages/`: 追加ページ（例: `01_home.py`）。Streamlit が自動検出。
- `components/`: 再利用可能な UI ヘルパー（ボタンなど）。
- `services/`: ビジネスロジックや外部連携。UI ロジックは置かない。
- `utils/`: 汎用ヘルパー。`config_loader.py` が YAML 設定読み込みを担当。
- `configs/settings.yaml`: デフォルト設定。値のハードコーディングを避ける。
- `domain/`: 型やモデルを置く場所（必要に応じて拡張）。
- `tests/`: ユニットテスト。モジュール構成に合わせて追加。
- 静的ファイルが増える場合は `assets/` を作成して配置する。

## 開発・ビルド・テスト
- 依存インストール: `pip install -r requirements.txt`（テストには `pytest` を追加インストール）。
- ローカル起動: `streamlit run app.py`（リポジトリルートで実行すると `pages/` も読み込まれる）。
- フォーマット/リント（推奨）: `python -m pip install black ruff` の後に `ruff .` と `black .` を実行。
- テスト実行: `pytest`。ルート外で走らせる場合は `PYTHONPATH=.` を付与。
- 開発ループ例: ブランチ作成→変更→`ruff .`→`black .`→`pytest`→スクリーンショット取得→PR。
- CI がなくても上記 lint/test をローカルで必ず回してから提出する。

## コーディングスタイルと命名
- PEP 8 準拠、インデントは 4 スペース。関数は短く単一責任で。
- 公開関数には型ヒントを付与し、パスは文字列より `Path` を優先。
- ファイル/モジュールは `snake_case`。Streamlit ページは 2 桁番号プレフィックス（例: `01_home.py`）。
- ドキュメンテーション文字列は簡潔に、日本語での説明を推奨。
- UI ヘルパーは `components/`、共有ロジックは `services/` または `utils/` にまとめる。
- 設定値を参照する際は辞書キーを定数化するより設定ファイルのキー名に合わせる（冗長なラップを避ける）。
- 仕様や README、コードコメントへの追記・修正、PR 説明は基本的に日本語で記述する。

## テスト指針
- フレームワーク: `pytest`。
- 命名: `test_<module>.py` に `test_<behavior>` 関数。
- 副作用の少ない関数を優先し、外部サービスはモックする。
- 設定読み込みやデフォルト値の修正時は回帰テストを追加。
- UI 部分は `st.session_state` の扱いに注意し、副作用を最小化してテストしやすくする。

## アーキテクチャ概要
- UI は Streamlit コンポーネントとページで完結させ、ビジネスロジックは `services/` に寄せる分離を維持する。
- 設定は常に `load_yaml_config` 経由で取得し、デフォルト値は設定ファイル側で管理する。
- 新しいドメインオブジェクトは `domain/` に型を置き、型ヒントで依存関係を明示する。

## コミットと PR
- コミットメッセージ: 短い命令形（例: “Add CTA helper”）で、関連変更ごとにまとめる。
- PR: 概要、新設定キーがあれば明記。UI 変更はスクリーンショット/GIF を添付。
- Issue がある場合はリンクし、対話的 UI の手動確認手順も記載。
- レビューを受けやすくするため、1 PR あたりの変更は小さく保つ。設定・UI 変更はテスト手順を追記。

## 設定とセキュリティ
- 秘密情報は `configs/settings.yaml` に置かず、環境変数や `.streamlit/secrets.toml` を利用。
- 設定読み込みは `load_yaml_config` に統一し、独自のパーサーを増やさない。
- キャッシュを使う場合（`st.cache_data` など）は、設定変更時にキャッシュクリア手順を明示し、古い値が残らないようにする。***
